ViPNet гайд (основано на https://github.com/xxhale/vipnet/blob/main/METODICHKA)
по большей сути более актуализированная и подробная версия методички выше + гайд по решению частых проблем

если вы читаете этот текст значит Net3 вы тут нигде не увидите потому что до него как до китая раком. дай бог у вас получится хоть что-то сделаь по этой методичке.

Чек-ап перед работой:
1. На всех машинах выключена синхронизация времени (в Workstation: Settings -> Options (справа от вкладки hardware) -> VMWare Tools -> Synchronize guest time with host -> ВЫКЛЮЧИТЬ)
2. IP-адреса машин настроены корректно (обязательно пропинговываем машинки через ping <IP> в командной строке)
3. На всех виндовых машинах отключен брандмауэр (можно сделать через cmd введя "netsh advfirewall set allprofiles state off")
4. На всех машинах установлен Visual C (VPN Administrator 4.6.7_R1\Soft\Центр управления сетью\Server Install\Packages\Visual C++)
4. Везде стоит одинаковая дата (я ставлю 1 ноября 2023 года: 01.11.2023)
5. ПЕРЕД НАЧАЛОМ РАБОТЫ НА ВСЕХ МАШИНАХ ЕСТЬ СНЕПШОТ, ГДЕ РАБОТА ЕЩЁ НЕ ПРОВОДИЛАСЬ (потом скажете спасибо)

Подключение диска к машинке (делалось в VMWare Workstation):
ПКМ по машине -> Settings -> ЛКМ по CD/DVD drive -> ставим галочку в Use ISO image file -> Browse... -> Ищем .iso с випнетом (у меня это был ViPNet2022.iso) в F7
применяем настройки и радуемся

Если из этого диска установщик запускается с ошибкой, значит нужно его переместить на рабочий стол и запускать оттуда (для некоторых установщиков может потребоваться запуск строго от имени админа)

// Задание 1

  I. Net1-Open:
УСТАНОВКА БАЗЫ ДАННЫХ
Директория: VPN Administrator 4.6.7_R1\Soft\Центр управления сетью\Server Install\Packages\SqlExpress2014
запускаем установщик (х64 для 64 бит, х86 для 32 бит). Далее делаем изменения согласно следующей последовательности:
1. Жмём New SQL
2. Named Instance будет WINNCCSQL
3. SQL Server Browser переключаем в Automatic
4. Выставляем режим Mixed Mode и вводим пароль xxXX1234
5. В том же окне во вкладке Filestream ставим все возможные галочки и запускаем установку
Надеемся что установка завершилась без ошибок. Далее:
6. В поиске ищем SQL Server 2014 Configuration Manager
7. Переходим в SQL Server Network Config
8. Включаем все протоколы (TCP/IP обязательно)
9. Переходим в SQL Server Services
10. ПКМ по SQL Server и SQL Server Browser и жмём Restart.

  II. Net1-Admin:
СТАВИМ СЕРВЕРНЫЙ ЦУС
Директория: VPN Administrator 4.6.7_R1\Soft\Центр управления сетью\Server Install\Packages\ru-ru
запускаем установщик WinNccServerInstaller_x64
Как проверять подключение:
В имя сервера до первого слэша (\) пишем IP-адрес, затем после слэша вводим само имя WINNCCSQL (e.x. 1.2.3.3\WINNCCSQL)
Проверка подлинности ставим SQL Server
Имя: sa
Пароль: xxXX1234

  III. Net1-Open
СТАВИМ КЛИЕНТСКИЙ ЦУС
Директория: VPN Administrator 4.6.7_R1\Soft\Центр управления сетью\Client Install\Packages\ru-ru
запускаем установщик WinNccServerInstaller_x64 через командную строку от имени администратора
команды для ввода (заранее перенесён установщик на рабочий стол): cd /
cd Users/Net1-Open/Desktop
WinNccClientInstaller_x64.msi
Открываем, вводим IP 1.2.3.1, данные от входа Administrator/Administrator, задаем пароль (это лучше скринить) xxXX1234
Ключ берём из диска F7 ViPNet_License.iso для Сети 1 (т.к. у нас Net1, логично)
ставим ключ, там всё легко до ужаса. Далее ничего не делаем и оставляем в машину таком состоянии.

  IV. Net1-Admin
  1. СТАВИМ УКЦ
Директория: VPN Administator 4.6.7_R1\Soft\Удостоверяющий и ключевой центр
Переносим все файлы из этой папки на рабочий стол в новую папку и запускаем установщик (setup)
После установки открываем УКЦ и делаем всё по следующим шагам:
1. Настройка новой базы данных
2. Пишем 1.2.3.3\winnccsql
Далее
Выбираем По имени и паролю пользователя SQL-сервера
Log: sa
Pas: xxXX1234
Потом далее до "настройки паролей"
Выбираем собственный пароль > Далее > Пишем xxXX1234
Так как ключ у нас установлен из прошлого шага, жмём "Далее" до раздела "Настройка паролей"
Выбираем пункт "Собственный пароль" и жмём "Далее". Вводим наш стандартный xxXX1234
  2. СТАВИМ VIPNET CLIENT 4.5.5
Запускаем установщик из ViPNet Client Windows. Делаем установку со стандартными параметрами
  3. СТАВИМ CA INFORMING
Запускаем установщик из ViPNet CA Informing. Делаем установку со стандартными параметрами
  V. Net1-Coord
СТАВИМ ПЕРВИЧНЫЕ НАСТРОЙКИ
Выбираем 2 пункт для установки
Соглашаемся на условия
Выбираем контитент Asia
Страна Russia (№38)
Регион Tomsk
Ставим время, которое стоит на остальных компах
На этапе активации ключа бросаем эту машину и переходим к следующему пункту

  VI. Net1-OperCA
СТАВИМ VIPNET CLIENT 4.5.5
Запускаем установщик из ViPNet Client Windows
Запускаем установщик из Publication Service
Запускаем установщик из Registration Point
пряники
Запускаем установщик из CA Informing
Если попросит ключи то можно забить
Перезагружаем машину

  VII. Net2-Client
УСТАНОВКА VIPNET CLIENT 4.5.5
Аналогично прошлому шагу устанавливаем клиентский випнет

  VIII. Net2-Coord
Аналогично шагу V настраиваем координатор.

# -----
# Задание 1 полностью выполнено. Дальше будет только хуже)))))
# -----

// Задание 2

  I. Net1-Open (Создание структуры ЦУС)
  ШАГ 1: Координаторы
ДОБАВЛЯЕМ КОРДЫ В ЦУС
Открываем ЦУС если он не открыт и нажимаем слева на координаторы.
Нажимаем на зелёный плюсик, вписываем имя такое же, как и называется машинка с кордом (напр Net1-Coord)
Режим работы оставляет как функцию VPN-сервера и создаем.
Далее ПКМ по нашему корду, жмём Свойства, жмём Роли узла. Удаляем их все.
Затем жмём добавить и выбираем корд HW-VA.
Проделываем тоже самое для всех кордов которые указаны в задании.
Далее пкм по первый корд -> Свойства -> Межсерверные каналы -> Net2-Coord
  ШАГ 2: Клиенты (или же сетевые узлы)
Затем переходим на вкладку "Клиенты" которая находится ниже вкладки "Координаторы"
Бьём по зелёному плюсу и указываем имя нашему клиенту. Указываем координатор согласно схеме из задания (условно если на схеме указано что машина Net1, то и коорд надо ставить Net1)
ОБЯЗАТЕЛЬНО УБИРАЕМ ГАЛОЧКУ С СОЗДАНИЕМ ОДНОИМЕННОГО ПОЛЬЗОВАТЕЛЯ (потому что у них будут другие имена согласно заданию)
  ШАГ 3: Пользователи и связи
Переходим во вкладку "Пользователи"
Удаляем всех пользователей если таковые есть.
Ударяем по зелёному плюсику и указываем имя пользователю. Указываем сетевой узел согласно схеме (т.е. те которые мы настраивали в шаге 2: клиенты)
Теперь настраиваем связи:
ПКМ по пользователю -> Свойства -> Связи с пользователями
Нажимаем "Добавить" и выбираем тех пользователей, которые указаны в табличке по заданию (называется она схема связи пользователей)
Если при добавлении связей вы наткнулись уже на какого-то пользователя, и он по заданию там и должен быть то поздравляю, вы настраиваете связи правильно
Если вы не понимаете как читать схему, то отдохните 15 минут, поешьте, позанимайтесь спортом и попробуйте снова.
Теперь возвращаемся во вкладку "Координаторы" и для каждого корда добавляем пользователей, которые существуют в его сети (нет1 для нет1, нет2 для нет2)
Делаем справочник для инициализации УКЦ:
Бьём по кнопкам Моя сеть - Создать справочники - Создать для всего списка
  На этом этапе создание структуры ЦУС завершено йоу.

  II. Net1-Admin (Инициализация УКЦ)
Если зашло в автоматический режим то выходим из него (он входит в него через 15 минут бездействия)
Заходим во вкладку "Сетевые узлы", выделяем мышкой все узлы, ПКМ -> Выдать новый дистрибутив ключей.
Вводим для всех узлов только пароли, остальное оставляем по умолчанию.
Копируем затем папку Dst for network #... на флешку и продолжаем долбить корд

  III. Net1-Coord и Net2-Coord (Установка ключей на корд и инициализация)
Обязательно проверяем время чтобы оно было на всех машинках одинаковым и ещё раз проверяем синхронизацию времени в виртуалках, надо чтобы было выклчюено
Так как мы остановились на этапе выбора ключа, мы выбираем установку ключей через USB, подключаем её к виртуалке
и жмём Next. Выбираем ключ для нашего корда (Центральный Офис, Coordinator Office). Если не пашет то Cancel и повторяем процедуру много много раз
Когда ключ встал, делаем всё по следующей инструкции:
1. Выбираем UP (для eth0)
2. Выбираем StaticIP
3. Вписываем IP-адрес (у меня 1.2.3.2, маска 255.255.255.240)
4. Выбираем UP для eth1 и повторяем шаги 2 и 3 (для 3 шага вписываем уже другой IP, у меня 8.9.10.1)
5. eth2 не поднимаем (выбираем DOWN)
6. Default Gateway будет 8.9.10.2
7. Листаем до Do you want probe VPN connection -> No
8. Do you want to start VPN services - Yes
9. Выбираем Run Command Shell

Координатор инициализирован. Проделываем тоже самое, но теперь для 2 корда (не забываем выбрать ключ соответствующий второму корду)

  IV. Net1-Admin, Net1-OperCA, Net2-Client (Инициализация ViPNet Client)
На самом деле машины могут разниться, поэтому смотрите по заданию куда должен вставать клиент
Шаги для каждой машины одинаковы. Проверяем время!
1. Запускаем ViPNet Client
2. Нажимаем "Настройка" -> "Установить ключи"
3. Покдлючаем нашу флешку и указываем путь до ключа
4. Ключ должен встать, если нет то пробуем несколько раз. Я не знаю что делать если ключи не встают
5. Вводим пароль от пользователя.
5.0. Выполняем пункты 5.№ если клиент установлен на машине, где стоит Серверный ЦУС!
5.1. Заходим в Сетевые фильтры -> Фильтры открытой сети
5.2. Нажимаем создать и пишем имя "БД" (мы разрешаем подключение к БД)
5.3. Действие -> Пропускать трафик -> ОК -> Применить

Фикс вопросов вместо символов если такое будет
Идём в C: > Windows > System32 > ищем C_1252.NLS
ПКМ > Свойства > Безопасность > Дополнительно > где Владелец Изменить > Дополнительно... > Поиск > Выбираем группу Administrators > Применить > Ок > 
Тут же на вкладке безопасность > Изменить > Выбираем Administrators > Даём полный доступ > Ok
Меняем имя файла 1252.NLS на 1252.NLS.bck
Зажимаем ctrl и берем 1251 и перетаскиваем в эту же папку где находимся
Появляется копия, меняем его имя на C_1252.NLS
Перезагружаемся
Вылезает окошко VipNet, нажимаем отмена > Продолжить запуск Windows > Login > Ставим дату и запускаем VipNet Client
